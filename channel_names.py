# Import necessary libraries
import datetime
import numpy as np

# Define all possible channel names in the BioSerenity dataset
channel_alias = {'F3': ['F3M2', 'F3A2', 'F3-M2', 'EEG F3-A2', 'FZM2', 'FZA2', 'FP1M2', 'FP1A2', 'F7M2', 'F7A2', 'F3:M2'],
                 'F4': ['F4M1', 'F4A1', 'F4-M1', 'EEG F4-A1', 'FZM2', 'FZA2', 'FP2M1', 'FP2A1', 'F8M1', 'F8A1', 'F4:M1'],
                 'C3': ['C3M2', 'C3A2', 'C3-M2', 'EEG C3-A2', 'C3M1', 'CZM2', 'C3:M2'],
                 'C4': ['C4M1', 'C4A1', 'C4-M1', 'EEG C4-A1', 'C4M2', 'CZM2', 'C4:M1'],
                 'O1': ['O1M2', 'O1A2', 'O1-M2', 'EEG O1-A2', 'O1M1', 'O1:M2'],
                 'O2': ['O2M1', 'O2A1', 'O2-M1', 'EEG O2-A1', 'O2M2', 'O2:M1'],
                 'A1A2': ['A1A2', 'M1M2', 'EEG A1-A2', 'EEG M1-M2'],
                 'LEOG': ['LOC', 'LEOG', 'E1-M2', 'EOG LOC-A2', 'EOG1:M2'],
                 'REOG': ['ROC', 'REOG', 'E2-M2', 'EOG ROC-A1', 'EOG ROC-A2', 'EOG2:M1'],
                 'Chin': ['Chin', 'CHIN', 'chin', 'EMG', 'CHINEMG', 'ChinEMG', 'EMG Chin', 'Chin1-Chin2', 'Chin 1-Chin 2'],
                 'ECG': ['ECG', 'EKG', 'ECG1-ECG2'],
                 'LLeg': ['LLeg', 'LLEG', 'LEMG', 'L EMG', 'LLEGEMG', 'LEG/L', 'Left Leg', 'L-Leg 1-L-Leg 2', 'Leg-L', 'Leg 1', 'LAT', 'Leg/L', 'LEG1'],
                 'RLeg': ['RLeg', 'RLEG', 'R EMG', 'RLEGEMG', 'LEG/R', 'Right Leg', 'R-Leg1-R-Leg2', 'Leg-R', 'Leg 2', 'RAT', 'Leg/R', 'LEG2', 'LEMG'],
                 'LArm': ['L-Arm', 'ARMLeft', 'LArm'],
                 'RArm': ['R-Arm', 'ARMRight', 'RArm'],
                 'PFlow': ['PFlo', 'Pflo', 'PFLO', 'PTAF', 'Nasal Pressure', 'PAP Flow', 'Pflow', 'PFlow', 'Ptaf', 'Flow Patient'],
                 'TFlow': ['TFlo', 'Tflo', 'TFLO', 'Flow', 'Thermistor', 'FLOW', 'Thermist', 'Airflow', 'Therm', 'Flow Patient'],
                 'CFlow': ['CFlo', 'Cflo', 'CFLO', 'VFLOW', 'CFlow', 'PAP Flow', 'CPAP Flow', 'Flow Patient'],
                 'Thorax': ['Tho', 'THO', 'Thorax', 'Thor', 'THOR', 'Effort THO'],
                 'Abdomen': ['Abd', 'ABD', 'Abdomen', 'Abdo', 'ABDM', 'Effort ABD'],
                 'SpO2': ['SAO2', 'SpO2'],
                 'Snoring': ['SNOR', 'Snore', 'PSNO', 'SNORE', 'MICR', 'Snoring', 'Micr', 'Micro', 'Snoring Sensor'],
                 'Position': ['POS', 'Body', 'BODY', 'Manual Pos', 'ManPosition', 'Body Position'],
                 'CPAP': ['CPAP', 'VPAP', 'CPress', 'PAP Press', 'CPAP Pressure', 'PressCheck'],
                 'IPAP': ['IPAP', 'xPAP IPAP', 'CPAP IPAP'],
                 'EPAP': ['EPAP', 'xPAP EPAP', 'CPAP EPAP'],
                 'Leak': ['Leak', 'PAP Leak', 'Leak Total', 'CPAP Leak', 'LEAK'],
                 'PPG': ['PPG', 'Pleth', 'Plethysmogram'],
                 'Pulse': ['Pulse', 'PulseRate', 'PulseR', 'PULSE', 'HR'],
                 'RR': ['RR', 'rr'],
                 'IntercostalEMG': ['ICOSEMG', 'INT 1', 'InterEMG', 'EMG1', 'INT'],
                 'Impedance': ['imp'],
                 'CO2': ['CO2', 'pCo2', 'EtCO2', 'ECO2', 'EtCO', 'CO2_Flow', 'tCO2', 'mmHG', 'mmHg']
                 }

# Define all possible channel names of unreferenced channels
unref_channel_alias = {'F3': ['F3'],
                       'F4': ['F4'],
                       'C3': ['C3'],
                       'C4': ['C4'],
                       'O1': ['O1'],
                       'O2': ['O2'],
                       'A1A2': [],
                       'LEOG': ['E1'],
                       'REOG': ['E2'],
                       'Chin': ['ChinL', 'Chin-L', 'ChinR', 'Chin-R'],
                       'ECG': ['ECG2', 'ECGII', 'ECG II'],
                       'LLeg': [],
                       'RLeg': [],
                       'LArm': [],
                       'RArm': [],
                       'PFlow': [],
                       'TFlow': [],
                       'CFlow': [],
                       'Thorax': [],
                       'Abdomen': [],
                       'SpO2': [],
                       'Snoring': [],
                       'Position': [],
                       'CPAP': [],
                       'IPAP': [],
                       'EPAP': [],
                       'Leak': [],
                       'PPG': [],
                       'Pulse': [],
                       'RR': [],
                       'IntercostalEMG': [],
                       'Impedance': [],
                       'CO2': []
                       }

# Define all possible channel names of reference channels
ref_channel_alias = {'F3': ['M2'],
                     'F4': ['M1'],
                     'C3': ['M2'],
                     'C4': ['M1'],
                     'O1': ['M2'],
                     'O2': ['M1'],
                     'A1A2': [],
                     'LEOG': ['M2'],
                     'REOG': ['M1'],
                     'Chin': ['ChinA', 'Chin-A'],
                     'ECG': ['ECG1', 'ECGI', 'ECG I'],
                     'LLeg': [],
                     'RLeg': [],
                     'LArm': [],
                     'RArm': [],
                     'PFlow': [],
                     'TFlow': [],
                     'CFlow': [],
                     'Thorax': [],
                     'Abdomen': [],
                     'SpO2': [],
                     'Snoring': [],
                     'Position': [],
                     'CPAP': [],
                     'IPAP': [],
                     'EPAP': [],
                     'Leak': [],
                     'PPG': [],
                     'Pulse': [],
                     'RR': [],
                     'IntercostalEMG': [],
                     'Impedance': [],
                     'CO2': []
                     }

# Define all possible names of channel units
channel_units_alias = {'F3': 'uV',
                 'F4': 'uV',
                 'C3': 'uV',
                 'C4': 'uV',
                 'O1': 'uV',
                 'O2': 'uV',
                 'A1A2': 'uV',
                 'LEOG': 'uV',
                 'REOG': 'uV',
                 'Chin': 'uV',
                 'ECG': 'uV',
                 'LLeg': 'uV',
                 'RLeg': 'uV',
                 'LArm': 'uV',
                 'RArm': 'uV',
                 'PFlow': 'uV',
                 'TFlow': 'uV',
                 'CFlow': 'l/min',
                 'Thorax': 'uV',
                 'Abdomen': 'uV',
                 'SpO2': '%',
                 'Snoring': 'uV',
                 'Position': np.nan,
                 'CPAP': 'cmH2O',
                 'IPAP': 'cmH2O',
                 'EPAP': 'cmH2O',
                 'Leak': 'L/min',
                 'PPG': np.nan,
                 'Pulse': 'bpm',
                 'RR': np.nan,
                 'IntercostalEMG': 'uV',
                 'Impedance': np.nan,
                 'CO2': 'mmHg'
                 }

# Convert all units that are spelled differently to the same convention
unit_alias = {'uV': ['uV', 'u'],
         'mV': ['mV', 'm'],
         'cmH2O': ['cmH20', 'cmH2O', 'CmH20', 'CmH2O', 'cm H2O', 'cm'],
         'L/min': ['l/min', 'L/min', 'LPM', 'Lpm', 'l/m', 'lpm'],
         'bpm': ['bmp', 'bpm', 'Bpm'],
         'mmHg': ['mmHg', 'mmHG']}

# Desired sampling frequencies for each channel
des_fs = {'F3': 128, 'F4': 128, 'C3': 128, 'C4': 128, 'O1': 128, 'O2': 128, 'LEOG': 128, 'REOG': 128, 'Chin': 128,
          'ECG': 128}

# Highpass filter cut-off frequencies 
hp_fs = {'F3': [0.3, 45.0], 'F4': [0.3, 45.0], 'C3': [0.3, 45.0], 'C4': [0.3, 45.0], 'O1': [0.3, 45.0],
         'O2': [0.3, 45.0], 'LEOG': [0.3, 45.0], 'REOG': [0.3, 45.0], 'Chin': 10.0, 'ECG': 0.3}
